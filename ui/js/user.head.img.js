var CutImg=function(){this.startX,this.startY,this.ctx,this.canvas,this.marginTop,this.paddWidth=20,this.bufferImg,this.endX,this.endY,this.width,this.height};CutImg.prototype.init=function(a,b){var c,d,e,f,g,h,i,j,k,l,m=this,n=document.body.clientWidth;m.width=n-m.paddWidth,c=document.body.clientHeight,d=0,e=0,f=!1,g=document.getElementById(a),m.canvas=g,this.paddWidth,i=document.createElement("canvas"),g.width=n-m.paddWidth,j=g.getContext("2d"),k=i.getContext("2d"),j.lineWidth=1,l=new Image,l.src=b,l.onload=function(){var a=l.width,b=l.height,d=b*(g.width/a);g.height=d,m.height=d,h=44+(c-44-d)/2,m.marginTop=h,i.width=g.width,i.height=g.height,k.drawImage(l,0,0,g.width,d),m.bufferImg=i,j.drawImage(i,0,0,g.width,d),m.ctx=j},g.addEventListener("touchstart",function(a){a.preventDefault();var b=a.targetTouches[0];d=b.pageX,e=b.pageY,m.startX=d,m.startY=e,f=!0}),g.addEventListener("touchmove",function(a){if(f){a.preventDefault();var b=a.targetTouches[0];if(b.pageX<d||b.pageY<e)return;j.fillStyle="rgba(0,0,0,.5)",j.strokeStyle="rgba(0,0,0,.5)",j.clearRect(0,0,this.width,this.height),j.drawImage(i,0,0,this.width,this.height),Math.abs(b.pageX-d),Math.abs(b.pageY-e),j.beginPath(),j.strokeRect(d,e-h,b.pageX-d,b.pageY-e),j.fillRect(0,0,g.width,e-h),j.fillRect(0,e-h,d,b.pageY-e),j.fillRect(b.pageX,e-h,g.width-b.pageX,b.pageY-e),j.fillRect(0,b.pageY-h,g.width,g.height+h-b.pageY),j.stroke(),j.closePath(),m.endX=b.pageX,m.endY=b.pageY}},!1),g.addEventListener("touchend",function(){f=!1})},CutImg.prototype.previewImg=function(){this.ctx.clearRect(0,0,this.width,this.height),this.ctx.drawImage(this.bufferImg,this.startX,this.startY-this.marginTop,this.endX-this.startX,this.endY-this.startY,0,0,this.width,this.height)},CutImg.prototype.rebackImg=function(){return this.canvas.toDataURL()};